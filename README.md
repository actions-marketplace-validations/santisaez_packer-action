# Packer GitHub Action

:balloon: Welcome to `packer-action`! :wave:

`packer-action` is a GitHub action that builds virtual-machine images using Packer.

It's a [Docker-based action](https://help.github.com/en/actions/building-actions/about-actions#types-of-actions) that uses the official [`hashicorp/packer`](https://hub.docker.com/r/hashicorp/packer) image from HashiCorp.


## Inputs

| Name | Description | Required | Default |
| --- | --- | --- | --- |
| `only` | Run only the specified Virtual-Machine builders | no | n/a |
| `options` | Optional command arguments to be provided when calling Packer | no | n/a |
| `secret` | The secret will be written to `/tmp/packer-secret`, see ["Providing Secrets"](#providing-secrets-to-packer) | no | n/a |
| `template` | Path to the config file of Packer | **yes** | `default.json` |


## Providing Secrets to Packer

There are two different ways to provide secrets to Packer: using [environment variables](#environment-variables) or with a [secret file](#secret-file).


### Environment Variables

This is the preferred method, use it unless the builder requires reading secrets from a file.

The secrets are provided to Packer as environment variables using the [encrypted secrets](https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets) feature of GitHub Actions.

Example:

```yaml
uses: santisaez/packer-action@v1
with:
  template: nginx-digitalocean.json
env:
  DIGITALOCEAN_API_TOKEN: ${{ secrets.DIGITALOCEAN_API_TOKEN }}
```


### Secret File

:information_source: Use this method **only if the builder does not support reading secrets from environment variables**, such as [Google Cloud](https://www.packer.io/docs/builders/googlecompute.html#precedence-of-authentication-methods).

The content of the [`secret` input parameter](#inputs) will be written to `/tmp/packer-secret`.

Example:

```yaml
uses: santisaez/packer-action@v1
with:
  template: nginx-gcp.json
  secret: ${{ secrets.GOOGLE_SERVICE_ACCOUNT }}
env:
  GOOGLE_APPLICATION_CREDENTIALS: '/tmp/packer-secret'
```

The [`googlecompute`](https://www.packer.io/docs/builders/googlecompute.html) builder of Packer reads the Service Account credentials from a file whose path is specified by the `GOOGLE_APPLICATION_CREDENTIALS` environment variable, and this variable points to the `/tmp/packer-secret` file generated by the GitHub action that contains the `secret` provided as input parameter.


## Example Usage

This is a basic use case where a Packer template and an API token are provided to create an image in DigitalOcean:

```yaml
uses: santisaez/packer-action@v1
with:
  template: nginx-digitalocean.json
env:
  DIGITALOCEAN_API_TOKEN: ${{ secrets.DIGITALOCEAN_API_TOKEN }}
```

See the [`/examples`](/examples) directory for more advanced workflow use cases.
